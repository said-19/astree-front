<div class="container mt-4">
  <h2><i class="fa-solid fa-users"></i> Gestion des Utilisateurs</h2>

  <!-- Formulaire ajout utilisateur -->
  <form (ngSubmit)="addUser()" class="row g-2 my-3">
    <div class="col-md-3"><input [(ngModel)]="newUser.nom" name="nom" class="form-control" placeholder="Nom" required>
    </div>
    <div class="col-md-3"><input [(ngModel)]="newUser.prenom" name="prenom" class="form-control" placeholder="Prénom"
        required></div>
    <div class="col-md-3"><input [(ngModel)]="newUser.email" name="email" type="email" class="form-control"
        placeholder="Email" required></div>
    <div class="col-md-3"><input [(ngModel)]="newUser.motDePasse" name="motDePasse" type="password" class="form-control"
        placeholder="Mot de passe" required></div>
    <div class="col-md-3"><input [(ngModel)]="newUser.numeroTelephone" name="numeroTelephone" class="form-control"
        placeholder="Téléphone" required></div>
    <div class="col-md-3">
      <select [(ngModel)]="newUser.role" name="role" class="form-select">
        <option value="Admin">Admin</option>
        <option value="Client">Client</option>
        <option value="Agent">Agent</option>
      </select>
    </div>
    <div class="col-md-3"><input [(ngModel)]="newUser.entrepriseId" name="entrepriseId" type="number"
        class="form-control" placeholder="Entreprise ID" required></div>
    <div class="col-md-3"><button type="submit" class="btn btn-success w-100"><i class="fa-solid fa-plus"></i>
        Ajouter</button></div>
  </form>

  <div class="row mb-3">
    <div class="col-md-4">
      <input type="text" class="form-control" placeholder="Rechercher par nom" [(ngModel)]="searchText">
    </div>
  </div>


  <!-- Tableau des utilisateurs -->
  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th (click)="setSort('id')">ID <i
            [ngClass]="sortColumn==='id' ? (sortDirection==='asc' ? 'fa-solid fa-arrow-up' : 'fa-solid fa-arrow-down') : ''"></i>
        </th>
        <th (click)="setSort('nom')">Nom <i
            [ngClass]="sortColumn==='nom' ? (sortDirection==='asc' ? 'fa-solid fa-arrow-up' : 'fa-solid fa-arrow-down') : ''"></i>
        </th>
        <th (click)="setSort('prenom')">Prénom <i
            [ngClass]="sortColumn==='prenom' ? (sortDirection==='asc' ? 'fa-solid fa-arrow-up' : 'fa-solid fa-arrow-down') : ''"></i>
        </th>
        <!-- Continue pour les colonnes souhaitées -->

        <th>Email</th>
        <th>Téléphone</th>
        <th>Rôle</th>
        <th>Entreprise</th>
        <th>Statut</th>
        <th>Photo</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of filteredUsers">
        <td>{{ user.id }}</td>
        <td *ngIf="editingUserId !== user.id">{{ user.nom }}</td>
        <td *ngIf="editingUserId === user.id">
          <input [(ngModel)]="user.nom" class="form-control form-control-sm">
        </td>

        <td *ngIf="editingUserId !== user.id">{{ user.prenom }}</td>
        <td *ngIf="editingUserId === user.id">
          <input [(ngModel)]="user.prenom" class="form-control form-control-sm">
        </td>

        <td *ngIf="editingUserId !== user.id">{{ user.email }}</td>
        <td *ngIf="editingUserId === user.id">
          <input [(ngModel)]="user.email" class="form-control form-control-sm">
        </td>

        <td *ngIf="editingUserId !== user.id">{{ user.numeroTelephone }}</td>
        <td *ngIf="editingUserId === user.id">
          <input [(ngModel)]="user.numeroTelephone" class="form-control form-control-sm">
        </td>



        <td *ngIf="editingUserId !== user.id">{{ user.role }}</td>
        <td *ngIf="editingUserId === user.id">
          <select [(ngModel)]="user.role" class="form-select form-select-sm">
            <option value="Admin">Admin</option>
            <option value="Client">Client</option>
            <option value="Agent">Agent</option>
          </select>
        </td>

        <td>{{ user.entrepriseId }}</td>
        <td><span class="badge" [ngClass]="user.isActive ? 'bg-success' : 'bg-danger'">{{ user.isActive ? 'Actif' :
            'Inactif' }}</span></td>
        <td>
          <img *ngIf="user.profileImagePath" [src]="user.profileImagePath" alt="Photo" class="rounded-circle"
            width="40">
          <input type="file" (change)="onFileSelected($event, user)" class="form-control form-control-sm mt-1 mb-1">
          <button class="btn btn-info btn-sm" (click)="uploadFile(user)"><i class="fa-solid fa-upload"></i></button>
        </td>
        <td>
          <button *ngIf="editingUserId !== user.id" class="btn btn-primary btn-sm me-2" (click)="editUser(user)">
            <i class="fa-solid fa-pen-to-square"></i>
          </button>

          <button *ngIf="editingUserId === user.id" class="btn btn-success btn-sm me-2" (click)="updateUser(user)">
            <i class="fa-solid fa-check"></i>
          </button>

          <button *ngIf="editingUserId === user.id" class="btn btn-secondary btn-sm me-2" (click)="cancelEdit()">
            <i class="fa-solid fa-xmark"></i>
          </button>

          <button class="btn btn-danger btn-sm" (click)="deleteUser(user.id)">
            <i class="fa-solid fa-trash"></i>
          </button>
        </td>

      </tr>
    </tbody>
  </table>
</div>